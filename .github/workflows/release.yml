name: Release Published

on:
  release:
    types: [published]

permissions:
  contents: read

env:
  APT_DISTRO: ${{ vars.APT_DISTRO || 'trixie' }}
  APT_COMPONENT: ${{ vars.APT_COMPONENT || 'main' }}

jobs:
  trigger-packaging:
    runs-on: ubuntu-latest
    # Only handle stable releases - pre-releases are handled by auto-prerelease.yml
    if: ${{ github.event.release.prerelease == false }}
    steps:
    - name: Trigger APT repository
      uses: peter-evans/repository-dispatch@v3
      with:
        token: ${{ secrets.REPO_DISPATCH_PAT }}
        repository: hatlabs/apt.hatlabs.fi
        event-type: package-updated
        client-payload: |
          {
            "repository": "${{ github.repository }}",
            "distro": "${{ env.APT_DISTRO }}",
            "channel": "stable",
            "component": "${{ env.APT_COMPONENT }}"
          }
