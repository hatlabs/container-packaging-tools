# CasaOS to HaLOS Path Transformation Rules
#
# This file defines rules for transforming volume paths from CasaOS conventions
# to HaLOS conventions. CasaOS uses specific path patterns that need to be
# converted to HaLOS's path structure.
#
# Format:
#   transforms:
#     - from: <casaos-path-pattern>
#       to: <halos-path-pattern>
#       description: <explanation>
#
# Variables available in path patterns:
#   {app} or {app_id} - Application identifier
#   {service} - Service name within multi-service apps
#   ${CONTAINER_DATA_ROOT} - HaLOS data root variable

# Path transformation rules (evaluated in order)
transforms:
  # CasaOS AppData directory â†’ HaLOS container data root
  - from: "/DATA/AppData/{app}/"
    to: "${CONTAINER_DATA_ROOT}/"
    description: "CasaOS AppData directory to HaLOS data root"

  - from: "/DATA/AppData/{app}"
    to: "${CONTAINER_DATA_ROOT}"
    description: "CasaOS AppData directory to HaLOS data root (no trailing slash)"

  # Alternative AppData patterns (without /DATA/ prefix)
  - from: "/AppData/{app}/"
    to: "${CONTAINER_DATA_ROOT}/"
    description: "AppData directory to HaLOS data root (no /DATA/ prefix)"

  - from: "/AppData/{app}"
    to: "${CONTAINER_DATA_ROOT}"
    description: "AppData directory to HaLOS data root (no /DATA/ prefix, no trailing slash)"

  # Generic DATA prefix - MUST go under CONTAINER_DATA_ROOT
  - from: "/DATA/"
    to: "${CONTAINER_DATA_ROOT}/"
    description: "CasaOS DATA prefix to container data root"

  # Config directories
  - from: "/config"
    to: "${CONTAINER_DATA_ROOT}/config"
    description: "Standard config directory"

  - from: "/data"
    to: "${CONTAINER_DATA_ROOT}/data"
    description: "Standard data directory"

  # Media directories - must be under CONTAINER_DATA_ROOT for isolation
  - from: "/media"
    to: "${CONTAINER_DATA_ROOT}/media"
    description: "Media directory under container data root"

  - from: "/movies"
    to: "${CONTAINER_DATA_ROOT}/movies"
    description: "Movies directory under container data root"

  - from: "/tv"
    to: "${CONTAINER_DATA_ROOT}/tv"
    description: "TV shows directory under container data root"

  - from: "/music"
    to: "${CONTAINER_DATA_ROOT}/music"
    description: "Music directory under container data root"

  - from: "/photos"
    to: "${CONTAINER_DATA_ROOT}/photos"
    description: "Photos directory under container data root"

  - from: "/books"
    to: "${CONTAINER_DATA_ROOT}/books"
    description: "Books directory under container data root"

  # Downloads
  - from: "/downloads"
    to: "${CONTAINER_DATA_ROOT}/downloads"
    description: "Downloads directory under container data root"

# Special handling instructions
special_cases:
  # Absolute paths that should remain unchanged
  preserve:
    - "/etc"
    - "/var"
    - "/usr"
    - "/tmp"
    - "/dev"
    - "/sys"
    - "/proc"


# Default behavior
default:
  # If no transform matches and path doesn't match special cases,
  # prepend CONTAINER_DATA_ROOT
  action: "prepend_data_root"
  description: "Unmapped paths are placed under CONTAINER_DATA_ROOT"

# Notes:
# - Transforms are applied in order from top to bottom
# - First matching transform wins
# - {app} variable is replaced with the lowercase app identifier
# - ${CONTAINER_DATA_ROOT} is a HaLOS environment variable
# - Paths in preserve list are never transformed
# - Configurable paths should be exposed as fields in config.yml
# - The converter should generate appropriate defaults for configurable paths
# - Volume modes (ro/rw) are preserved during transformation
